<html lang="en">
<head>
    <meta charset="UTF-8">


    <title>those GIRLS you.know</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            position: fixed;
            background-color: #000000;
        }

        canvas {
            width: 100%;
            height: 100%;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            outline: none;
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0); /* mobile webkit */
        }

    </style>
</head>
<body>
<script src='lib/stats.js/build/stats.min.js'></script>
<script src='lib/pixi.min.js'></script>
<script type="module">

    import * as THREE from "./lib/three/build/three.module.js";

    // stats
    let stats = new Stats();
    stats.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom
    document.body.appendChild(stats.dom);

    // audio
    // let those_girls_you_know = new Audio('music/those-girls-you-know.mp3');
    // if (those_girls_you_know) those_girls_you_know.loop = false;
    // let audioContext = null;

    // Renderers
    let rendererThree;
    let rendererPixi;

    // 3d objects
    let scene, camera;
    let bo;

    let turningLeft = false;
    let turningRight = false;

    init();
    animate();


    function init() {
        let canvas = document.getElementById("screen");
        rendererThree = new THREE.WebGLRenderer({
            canvas: canvas
        });
        rendererPixi = new PIXI.Renderer({
            view: canvas,
            context: rendererThree.getContext()
        });

        setup3d();

        document.addEventListener('keydown', onDocumentKeyDown, false);
        document.addEventListener('keyup', onDocumentKeyUp, false);
    }


    function animate() {
        stats.begin();
        rendererThree.state.reset();
        render3d();
        rendererThree.state.reset();

        rendererPixi.reset();
        render2d();
        rendererPixi.reset();

        stats.end();
        requestAnimationFrame(animate);
    }

    function setup3d() {
        scene = new THREE.Scene();

        camera = new THREE.PerspectiveCamera(80, window.innerWidth / window.innerHeight, 0.1, 1000);
        rendererThree = new THREE.WebGLRenderer();

        scene.background = new THREE.Color('pink'); //#85C1E9
        scene.fog = new THREE.FogExp2('white', 0.05);
        scene.color = 0xFFFFFF;

        rendererThree.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(rendererThree.domElement);

        let shinyMaterial = new THREE.MeshStandardMaterial({
            color: 0x85C1E9,
            roughness: 1,
            flatShading: true
        });

        let arenaSize = 50;
        let canyonWidth = 4;
        let leftBound = -canyonWidth;
        let rightBound = canyonWidth;
        for (let i = 0; i < 500; i++) {
            let cubeX = randomInt(arenaSize);
            let cubeY = randomInt(arenaSize) - arenaSize / 2;
            if (cubeY > leftBound && cubeY < rightBound) continue;
            let geometry = new THREE.BoxGeometry(1, 1, randomInt(15) + 5);
            let cube = new THREE.Mesh(geometry, shinyMaterial);

            cube.position.x = cubeX;
            cube.position.y = cubeY;
            scene.add(cube);
        }

        // floor
        let floorGeometry = new THREE.PlaneGeometry(1000, 1000);
        let plane = new THREE.Mesh(floorGeometry, shinyMaterial);
        // plane.position.x += 1000 / 2;
        // plane.position.y += 1000 / 2;
        plane.position.z = 0;
        // scene.add(plane);

        // light
        let dirLight;
        dirLight = new THREE.DirectionalLight(0xFFFFFF);
        dirLight.position.set(-2, 5, 3).normalize();
        scene.add(dirLight);

        let light = new THREE.AmbientLight(0xFFFFFF); // soft white light
        scene.add(light);

        camera.position.z = 0;
        camera.position.x = 0;
        camera.position.y = 0;
        camera.rotation.x = 90 * Math.PI / 180;
        camera.rotation.y = -90 * Math.PI / 180;
        camera.rotateOnAxis(new THREE.Vector3(-1, 0, 0), -0.1);

        bo = addTitleImage(scene);

    }

    function addTitleImage(scene) {
        let loader = new THREE.TextureLoader();
        let texture = loader.load('images/girls/Bo Derek.jpg');
        texture.minFilter = THREE.LinearFilter;

        let sideColor = 0x85C1E9;
        var cubeMaterial = [
            new THREE.MeshBasicMaterial({
                map: texture, //left
                fog: true,
            }),
            new THREE.MeshBasicMaterial({
                map: texture, //right
                fog: true,
            }),
            new THREE.MeshBasicMaterial({
                color: sideColor, // top
                fog: true,
            }),
            new THREE.MeshBasicMaterial({
                color: sideColor, // bottom
                fog: true,
            }),
            new THREE.MeshBasicMaterial({
                color: sideColor, // front
                fog: true,
            }),
            new THREE.MeshBasicMaterial({
                color: sideColor, //back
                fog: true,
            })
        ];


        // preserve ratio
        let scale = 2;
        let geometry = new THREE.BoxBufferGeometry(.1, scale, scale * 375 / 500);
        // let geometry = new THREE.PlaneGeometry(scale * 375 / 500, scale);
        for (let i = 0; i < 1000; i++) {
            let rotationAmount = 2 * Math.PI / 15 * i;


            //Make a pivot
            let pivot = new THREE.Group();


            // make object
            let mesh = new THREE.Mesh(geometry, cubeMaterial);
            mesh.position.set(i/10 + 10, 0, 5);
            mesh.rotation.x = Math.PI / 2;



//Add object to pivot
            pivot.add(mesh);
            // pivot.position.set(new THREE.Vector3(0,0,0));

//rotate the object around pivot
            pivot.rotation.x = rotationAmount;

            // mesh.rotateOnAxis(new THREE.Vector3(1, 0, 0), rotationAmount);
            scene.add(pivot);
        }
        let mesh = new THREE.Mesh(geometry, cubeMaterial);
        return mesh;
    }

    function addTitleImageB(scene) {
        let loader = new THREE.TextureLoader();
        let texture = loader.load('images/girls/Bo Derek.jpg');
        texture.minFilter = THREE.LinearFilter;
        let material = new THREE.MeshLambertMaterial({
            map: texture,
            fog: true,
            side: THREE.DoubleSide,
            flatShading: true,
            roughness: 1
        });
        // preserve ratio
        let scale = 2;
        let geometry = new THREE.PlaneGeometry(scale * 375 / 500, scale);
            let mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(10, 0, 1);
            mesh.rotation.y = -Math.PI / 2;
            mesh.rotation.x = Math.PI / 2;
            mesh.receiveShadow = false;
            mesh.castShadow = false;
            scene.add(mesh);
        return mesh;
    }


    function render3d() {
        // game.render(fpsAdjustment);
        let now = Date.now();
        camera.position.x += Math.sin(now / 100) * 0.02 + .025;
        camera.position.z = Math.sin(now / 100) * 0.01 + 0.2;

        if (turningLeft) {
            // camera.rotation.y += 2 * Math.PI / 180;
            camera.rotateOnWorldAxis(new THREE.Vector3(0, 0, 1), 2 * Math.PI / 180);
        }
        if (turningRight) {
            // camera.rotation.y += -2 * Math.PI / 180;
            camera.rotateOnWorldAxis(new THREE.Vector3(0, 0, 1), -2 * Math.PI / 180);
        }

        // bo.rotateOnWorldAxis(new THREE.Vector3(0,0,1), -2 * Math.PI / 180);

        rendererThree.render(scene, camera);
    }

    function render2d() {
        // activeScreen.render();
    }


    function startAudio() {
        // if (!audioContext) {
        //     // https://stackoverflow.com/questions/9811429/html5-audio-tag-on-safari-has-a-delay
        //     const AudioContext = window.AudioContext || window.webkitAudioContext;
        //     audioContext = new AudioContext();
        // }
        // if (sounds && !soundsLoaded) {
        //     for (let audio of Object.values(sounds)) {
        //         audio.play();
        //         audio.pause();
        //         audio.currentTime = 0;
        //     }
        //     soundsLoaded = true;
        // }
        // if (musicOn && !songs.isSongPlaying) {
        //     // gapless audio loop
        //     // https://stackoverflow.com/questions/7330023/gapless-looping-audio-html5
        //     songs.motel_bedroom.addEventListener('timeupdate', function () {
        //         let buffer = .4;
        //         if (this.currentTime > this.duration - buffer) {
        //             this.currentTime = 0;
        //             this.play();
        //         }
        //     }, false);
        //     songs.motel_bedroom.play();
        //     songs.isSongPlaying = true;
        // }
    }

    function onDocumentKeyDown(event) {
        let keyCode = event["which"];
        if (keyCode === 37) {
            turningLeft = true;
        } else if (keyCode === 39) {
            turningRight = true;
        }
    }

    function onDocumentKeyUp(event) {
        let keyCode = event["which"];
        if (keyCode === 37) {
            turningLeft = false;
        } else if (keyCode === 39) {
            turningRight = false;
        }
    }

    function randomInt(max) {
        return Math.floor(Math.random() * Math.floor(max));
    }


</script>
<canvas id="screen">
    <h1>THOSE GIRLS YOU KNOWT</h1>

    <p>
        Those girls you know<br>
        Looking at the lenses of their phone<br>
        Minimize their blemishes<br>
        With downward angles<br>
        And tag<br>
        Their thoughts
    </p>

    <p>
        Now when you are<br>
        Following the mentions of a star<br>
        Their catchy, sassy, cutesy captions<br>
        Are designed to win<br>
        Your heart
    </p>

    <p>
        Underneath their makeup<br>
        Branding with their clothes<br>
        Underneath their makeup are those GIRLS
    </p>

    <p>
        Underneath your make up<br>
        Practicing your pose<br>
        Underneath your make up are those...
    </p>

    <p>
        ...Girls you know<br>
        Looking at the lenses of your phone<br>
        Minimize your blemishes<br>
        With downward angles<br>
        And tag<br>
        your thoughts

    </p>

</canvas>

</body>
</html>
